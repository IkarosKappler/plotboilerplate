/*!
 * PlotBoilerplate,
 * Git branch https://github.com/IkarosKappler/plot-boilerplate/commit/e4e11ba
 */!function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,i){i(2),i(3),i(4),i(5),i(6),i(7),i(8),i(9),i(10),i(11),i(12),i(13),i(14),t.exports=i(15)},function(t,e){!function(t){"use strict";var e=function(){for(var t in this.draggable=!0,this.isSelected=!1,e.model)this[t]=e.model[t]};e.model={draggable:!0,isSelected:!1},t.VertexAttr=e}(window)},function(t,e){!function(t){"use strict";var e=function(t){this.drag=[],this.dragStart=[],this.dragEnd=[],this.vertex=t};e.prototype.addDragListener=function(t){this.drag.push(t)},e.prototype.addDragStartListener=function(t){this.dragStart.push(t)},e.prototype.addDragEndListener=function(t){this.dragEnd.push(t)},e.prototype.fireDragEvent=function(t){i(this,this.drag,t)},e.prototype.fireDragStartEvent=function(t){i(this,this.dragStart,t)},e.prototype.fireDragEndEvent=function(t){i(this,this.dragEnd,t)};var i=function(t,e,i){for(var s in void 0===i.params&&(i.params={}),i.params.vertex=t.vertex,e)e[s](i)};t.VertexListeners=e}(window)},function(t,e){var i,s;i=window||t.exports,(s=i.Vertex=function(t,e){"object"==typeof t&&"number"==typeof t.x&&"number"==typeof t.y?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),this.attr=new VertexAttr,this.listeners=new VertexListeners(this)}).prototype.set=function(t,e){return"object"==typeof t&&"number"==typeof t.x&&"number"==typeof t.y?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),this},s.prototype.add=function(t,e){return"number"==typeof t?(this.x+=t,"number"==typeof e&&(this.y+=e)):(this.x+=t.x,this.y+=t.y),this},s.prototype.addXY=function(t,e){return this.x+=t,this.y+=e,this},s.prototype.sub=function(t,e){return"object"==typeof t&&"number"==typeof t.x&&"number"==typeof t.y?(this.x-=t.x,this.y-=t.y):(this.x-=t,this.y-=e),this},s.prototype.equals=function(t){var e=Math.abs(this.x-t.x)<1e-6,i=Math.abs(this.y-t.y)<1e-6;return e&&i},s.prototype.clone=function(){return new s(this.x,this.y)},s.prototype.distance=function(t){return Math.sqrt(Math.pow(t.x-this.x,2)+Math.pow(t.y-this.y,2))},s.prototype.scale=function(t,e){return e&&void 0!==e||(e=new s(0,0)),this.x=e.x+(this.x-e.x)*t,this.y=e.y+(this.y-e.y)*t,this},s.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},s.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},s.prototype.toString=function(){return"("+this.x+","+this.y+")"}},function(t,e,i){(function(t){var e;(e=window||t.export).Grid=function(t,e){this.center=t,this.size=e},e.Grid.utils={baseLog:function(t,e){return Math.log(t)/Math.log(e)},mapRasterScale:function(t,e){var i=1;return e>=1?(i=Math.abs(Math.floor(1/Grid.utils.baseLog(t,e))),i=1/Math.pow(t,i)):(i=Math.abs(Math.floor(Grid.utils.baseLog(1/t,e+1))),i=Math.pow(t,i)),i}}}).call(this,i(0)(t))},function(t,e,i){(function(t){!function(t){var e=function(t,e){this.a=t,this.b=e};e.prototype.length=function(){return Math.sqrt(Math.pow(this.b.x-this.a.x,2)+Math.pow(this.b.y-this.a.y,2))},e.prototype.sub=function(t){return new e(this.a.sub(t),this.b.sub(t))},e.prototype.normalize=function(){this.b.set(this.a.x+(this.b.x-this.a.x)/this.length(),this.a.y+(this.b.y-this.a.y)/this.length())},e.prototype.scale=function(t){this.b.set(this.a.x+(this.b.x-this.a.x)*t,this.a.y+(this.b.y-this.a.y)*t)},e.prototype.angle=function(t){var e=this.b.clone().sub(this.a),i=t.b.clone().sub(t.a);return Math.atan2(i.x,i.y)-Math.atan2(e.x,e.y)},e.prototype.vertAt=function(t){return new Vertex(this.a.x+(this.b.x-this.a.x)*t,this.a.y+(this.b.y-this.a.y)*t)},e.prototype.intersection=function(t){var e=(t.b.y-t.a.y)*(this.b.x-this.a.x)-(t.b.x-t.a.x)*(this.b.y-this.a.y);if(0==e)return null;var i=this.a.y-t.a.y,s=this.a.x-t.a.x,r=(t.b.x-t.a.x)*i-(t.b.y-t.a.y)*s,n=(this.b.x-this.a.x)*i-(this.b.y-this.a.y)*s;return i=r/e,s=n/e,new Point(this.a.x+i*(this.b.x-this.a.x),this.a.y+i*(this.b.y-this.a.y))},e.prototype.toSVGString=function(t){t=t||{};var e=[];return e.push("<line"),t.className&&e.push(' class="'+t.className+'"'),e.push(' x1="'+this.a.x+'"'),e.push(' y1="'+this.a.y+'"'),e.push(' x2="'+this.b.x+'"'),e.push(' y2="'+this.b.y+'"'),e.push(" />"),e.join("")},this.toString=function(){return"{ a : "+this.a.toString()+", b : "+this.b.toString()+" }"},t.Line=e}(window||t.export)}).call(this,i(0)(t))},function(t,e){!function(t){"use strict";var e=function(t,e,i,s){Object.call(this),this.startPoint=t,this.startControlPoint=i,this.endPoint=e,this.endControlPoint=s,this.curveIntervals=30,this.segmentCache=[],this.segmentLengths=[],this.arcLength=null,this.updateArcLengths()};e.START_POINT=0,e.START_CONTROL_POINT=1,e.END_CONTROL_POINT=2,e.END_POINT=3,(e.prototype=new Object).constructor=e,e.prototype.START_POINT=0,e.prototype.START_CONTROL_POINT=1,e.prototype.END_CONTROL_POINT=2,e.prototype.END_POINT=3,e.prototype.moveCurvePoint=function(t,e,i,s){t==this.START_POINT?(this.getStartPoint().add(e),i&&this.getStartControlPoint().add(e)):t==this.START_CONTROL_POINT?this.getStartControlPoint().add(e):t==this.END_CONTROL_POINT?this.getEndControlPoint().add(e):t==this.END_POINT?(this.getEndPoint().add(e),i&&this.getEndControlPoint().add(e)):console.log("[IKRS.CubicBezierCurve.moveCurvePoint] pointID '"+t+"' invalid."),s&&this.updateArcLengths()},e.prototype.translate=function(t){this.startPoint.add(t),this.startControlPoint.add(t),this.endControlPoint.add(t),this.endPoint.add(t)},e._scalePoint=function(t,e,i){t.sub(e),t.setX(t.x*i.x),t.setY(t.y*i.y),t.add(e)},e.prototype.getLength=function(){return this.arcLength},e.prototype.locateCurveByPoint=function(t){for(var e=0;e<this.bezierCurves.length;e++)if(this.bezierCurves[e].startPoint.equals(t)||this.bezierCurves[e].endPoint.equals(t))return e;return-1},e.prototype.computeVerticalAreaSize=function(t,e,i){if(0==e)throw"Cannot compute bezier curve's vertical area size with delta=0.";if(this.segmentCache.length<=1)return 0;for(var s=0,r=0;r+1<this.segmentCache.length;r++)s+=this._computeVerticalAreaSizeForSegment(t,e,i,r);return s},e.prototype._computeVerticalAreaSizeForSegment=function(t,e,i,s){if(s+1>=this.segmentCache.length)return 0;var r=this.segmentCache[s],n=this.segmentCache[s+1],o=n.y-r.y,a=t-r.x,h=t-n.x,c=h+(a-h)/2;return i?Math.abs(o*c):o*c},e.prototype.computeVerticalRevolutionVolumeSize=function(t,e){if(this.segmentCache.length<=1)return 0;for(var i=0,s=0;s+1<this.segmentCache.length;s++)i+=this._computeVerticalRevolutionVolumeSizeForSegment(t,e,s);return i},e.prototype._computeVerticalRevolutionVolumeSizeForSegment=function(t,e,i){if(i+1>=this.segmentCache.length)return 0;var s=this.segmentCache[i],r=this.segmentCache[i+1],n=r.y-s.y,o=(t-s.x+(t-r.x))/2,a=Math.PI*Math.pow(o,2)*n;return e?Math.abs(a):a},e.prototype.updateArcLengths=function(){var t=new Vertex(this.startPoint.x,this.startPoint.y),e=new Vertex(0,0),i=1/this.curveIntervals;this.segmentCache=[],this.segmentCache.push(this.startPoint),this.segmentLengths=[],this.arcLength=0;for(var s=0;s<this.curveIntervals;s++){e=this.getPoint((s+1)*i),this.segmentCache.push(e);var r=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));this.segmentLengths.push(r),this.arcLength+=r,t=e,i}},e.prototype.getStartPoint=function(){return this.startPoint},e.prototype.getEndPoint=function(){return this.endPoint},e.prototype.getStartControlPoint=function(){return this.startControlPoint},e.prototype.getEndControlPoint=function(){return this.endControlPoint},e.prototype.getPointByID=function(t){if(t==this.START_POINT)return this.startPoint;if(t==this.END_POINT)return this.endPoint;if(t==this.START_CONTROL_POINT)return this.startControlPoint;if(t==this.END_CONTROL_POINT)return this.endControlPoint;throw"Invalid point ID '"+t+"'."},e.prototype.getPoint=function(t){var e=this.startPoint.x*Math.pow(1-t,3)+3*this.startControlPoint.x*t*Math.pow(1-t,2)+3*this.endControlPoint.x*Math.pow(t,2)*(1-t)+this.endPoint.x*Math.pow(t,3),i=this.startPoint.y*Math.pow(1-t,3)+3*this.startControlPoint.y*t*Math.pow(1-t,2)+3*this.endControlPoint.y*Math.pow(t,2)*(1-t)+this.endPoint.y*Math.pow(t,3);return new Vertex(e,i)},e.prototype.getPointAt=function(t){return this.getPoint(t/this.arcLength)},e.prototype.getTangent=function(t){var e=this.getStartPoint(),i=this.getStartControlPoint(),s=this.getEndControlPoint(),r=this.getEndPoint(),n=t*t,o=1-2*t+n,a=-3*e.x*o+i.x*(3*o-6*(t-n))+s.x*(6*(t-n)-3*n)+3*r.x*n,h=-3*e.y*o+i.y*(3*o-6*(t-n))+s.y*(6*(t-n)-3*n)+3*r.y*n;return new Vertex(a,h)},e.prototype.convertU2T=function(t){return Math.max(0,Math.min(1,t/this.arcLength))},e.prototype.getTangentAt=function(t){return this.getTangent(this.convertU2T(t))},e.prototype.getPerpendicularAt=function(t){return this.getPerpendicular(this.convertU2T(t))},e.prototype.getPerpendicular=function(t){var e=this.getTangent(t);return new Vertex(e.y,-e.x)},e.prototype.computeBoundingBox=function(){return BoundingBox2.computeFromPoints(this.segmentCache)},e.prototype.clone=function(){return new e(this.getStartPoint().clone(),this.getEndPoint().clone(),this.getStartControlPoint().clone(),this.getEndControlPoint().clone())},e.prototype.equals=function(t){return!!t&&(!!(t.startPoint&&t.endPoint&&t.startControlPoint&&t.endControlPoint)&&(this.startPoint.equals(t.startPoint)&&this.endPoint.equals(t.endPoint)&&this.startControlPoint.equals(t.startControlPoint)&&this.endControlPoint.equals(t.endControlPoint)))},e.prototype.toSVGPathData=function(){var t=[];return t.push("M "),t.push(this.startPoint.x),t.push(" "),t.push(this.startPoint.y),t.push(" C "),t.push(this.startControlPoint.x),t.push(" "),t.push(this.startControlPoint.y),t.push(" "),t.push(this.endControlPoint.x),t.push(" "),t.push(this.endControlPoint.y),t.push(" "),t.push(this.endPoint.x),t.push(" "),t.push(this.endPoint.y),t.join("")},e.prototype.toJSON=function(t){return"{ "+(t?"\n\t":"")+'"startPoint" : ['+this.getStartPoint().x+","+this.getStartPoint().y+"], "+(t?"\n\t":"")+'"endPoint" : ['+this.getEndPoint().x+","+this.getEndPoint().y+"], "+(t?"\n\t":"")+'"startControlPoint": ['+this.getStartControlPoint().x+","+this.getStartControlPoint().y+"], "+(t?"\n\t":"")+'"endControlPoint" : ['+this.getEndControlPoint().x+","+this.getEndControlPoint().y+"]"+(t?"\n\t":"")+" }"},e.fromJSON=function(t){var i=JSON.parse(t);return e.fromObject(i)},e.fromObject=function(t){if("object"!=typeof t)throw"[IKRS.CubicBezierCurve.fromObject] Can only build from object.";if(!t.startPoint)throw'[IKRS.CubicBezierCurve.fromObject] Object member "startPoint" missing.';if(!t.endPoint)throw'[IKRS.CubicBezierCurve.fromObject] Object member "endPoint" missing.';if(!t.startControlPoint)throw'[IKRS.CubicBezierCurve.fromObject] Object member "startControlPoint" missing.';if(!t.endControlPoint)throw'[IKRS.CubicBezierCurve.fromObject] Object member "endControlPoint" missing.';return new e(new Vertex(t.startPoint[0],t.startPoint[1]),new Vertex(t.endPoint[0],t.endPoint[1]),new Vertex(t.startControlPoint[0],t.startControlPoint[1]),new Vertex(t.endControlPoint[0],t.endControlPoint[1]))},e.fromArray=function(t){if(!Array.isArray(t))throw"[IKRS.CubicBezierCurve.fromArray] Can only build from object.";if(4!=t.length)throw"[IKRS.CubicBezierCurve.fromArray] Can only build from array with four elements.";return new e(t[0],t[1],t[2],t[3])},t.CubicBezierCurve=e}(window)},function(t,e){!function(t){"use strict";var e=function(t){Object.call(this),t||(t=[]),this.totalArcLength=0,this.adjustCircular=!1,this.bezierCurves=[];for(var e=1;e<t.length;e++){var i=new THREE.Box2(t[e].x-t[e-1].x,t[e].y-t[e-1].y),s=new CubicBezierCurve(t[e-1],t[e],new Vertex(t[e-1].x,t[e-1].y-i.min/2),new Vertex(t[e].x+i.max/2,t[e].y));this.bezierCurves.push(s),this.totalArcLength+=s.getLength(),this.bezierCurves.length>=2&&this.adjustSuccessorControlPoint(this.bezierCurves.length-2,!0,!0)}};e.prototype.constructor=e,e.START_POINT=0,e.START_CONTROL_POINT=1,e.END_CONTROL_POINT=2,e.END_POINT=3,e.prototype.START_POINT=0,e.prototype.START_CONTROL_POINT=1,e.prototype.END_CONTROL_POINT=2,e.prototype.END_POINT=3,e.prototype.addCurve=function(t){if(null==t||void 0===t)throw"Cannot add null curve to bézier path.";this.bezierCurves.push(t),this.bezierCurves.length>1?(t.startPoint=this.bezierCurves[this.bezierCurves.length-2].endPoint,this.adjustSuccessorControlPoint(this.bezierCurves.length-2,!0,!0)):this.totalArcLength+=t.getLength()},e.prototype.locateCurveByStartPoint=function(t){for(var e in this.bezierCurves)if(this.bezierCurves[e].startPoint.equals(t))return e;return-1},e.prototype.locateCurveByStartControlPoint=function(t){for(var e in this.bezierCurves)if(this.bezierCurves[e].startControlPoint.equals(t))return e;return-1},e.prototype.locateCurveByEndControlPoint=function(t){for(var e in this.bezierCurves)if(this.bezierCurves[e].endControlPoint.equals(t))return e;return-1},e.prototype.getLength=function(){return this.totalArcLength},e.prototype.computeVerticalAreaSize=function(t,e){for(var i=this.computeBoundingBox().xMax,s=0,r=0;r<this.bezierCurves.length;r++)s+=this.bezierCurves[r].computeVerticalAreaSize(i,t,e);return s},e.prototype.computeVerticalRevolutionVolumeSize=function(t){for(var e=this.computeBoundingBox().xMax,i=0,s=0;s<this.bezierCurves.length;s++)i+=this.bezierCurves[s].computeVerticalRevolutionVolumeSize(e,t);return i},e.prototype.updateArcLengths=function(){this.totalArcLength=0;for(var t=0;t<this.bezierCurves.length;t++)this.bezierCurves[t].updateArcLengths(),this.totalArcLength+=this.bezierCurves[t].getLength()},e.prototype.getCurveCount=function(){return this.bezierCurves.length},e.prototype.getCurveAt=function(t){return this.bezierCurves[t]},e.prototype.removeEndPoint=function(){if(this.bezierCurves.length<=1)return!1;for(var t=[this.bezierCurves.length-1],e=0;e<this.bezierCurves.length-1;e++)t[e]=this.bezierCurves[e];return this.totalArcLength-=this.bezierCurves[this.bezierCurves.length-1].getLength(),this.bezierCurves=t,!0},e.prototype.removeStartPoint=function(){if(this.bezierCurves.length<=1)return!1;for(var t=[this.bezierCurves.length-1],e=1;e<this.bezierCurves.length;e++)t[e-1]=this.bezierCurves[e];return this.totalArcLength-=this.bezierCurves[0].getLength(),this.bezierCurves=t,!0},e.prototype.joinAt=function(t){if(t<0||t>=this.bezierCurves.length)return!1;var e=this.bezierCurves[t-1],i=this.bezierCurves[t],s=e.getStartControlPoint().clone();s.sub(e.getStartPoint()),s.multiplyScalar(2),s.add(e.getStartPoint());var r=i.getEndControlPoint().clone();r.sub(i.getEndPoint()),r.multiplyScalar(2),r.add(i.getEndPoint());for(var n=new IKRS.CubicBezierCurve(e.getStartPoint(),i.getEndPoint(),s,r),o=[this.bezierCurves.length-1],a=0;a<t-1;a++)o[a]=this.bezierCurves[a];o[t-1]=n;for(a=t;a+1<this.bezierCurves.length;a++)o[a]=this.bezierCurves[a+1];return this.bezierCurves=o,this.updateArcLengths(),!0},e.prototype.splitAt=function(t,e){if(t<0||t>=this.bezierCurves.length)return!1;var i=this.bezierCurves[t];if(e<1||e-1>=i.segmentCache.length)return!1;for(var s=this.bezierCurves.length;s>t;s--)this.bezierCurves[s]=this.bezierCurves[s-1];for(var r=0,n=0;n<e;n++)r+=i.segmentLengths[n];var o=i.getTangentAt(r);o=o.multiplyScalar(.25);var a=i.segmentCache[e].clone();a.sub(o);var h=i.segmentCache[e].clone();h.add(o);var c=i.getStartControlPoint().clone();c.sub(i.getStartPoint()),c.multiplyScalar(.25),c.add(i.getStartPoint());var u=i.getEndControlPoint().clone();u.sub(i.getEndPoint()),u.multiplyScalar(.25),u.add(i.getEndPoint());var l=new CubicBezierCurve(i.getStartPoint(),i.segmentCache[e],c,a),d=new CubicBezierCurve(i.segmentCache[e],i.getEndPoint(),h,u);return this.bezierCurves[t]=l,this.bezierCurves[t+1]=d,this.totalArcLength-=i.getLength(),this.totalArcLength+=l.getLength(),this.totalArcLength+=d.getLength(),!0},e.prototype.translate=function(t){for(var e=0;e<this.bezierCurves.length;e++){(i=this.bezierCurves[e]).getStartPoint().add(t),i.getStartControlPoint().add(t),i.getEndControlPoint().add(t)}var i;(i=this.bezierCurves[this.bezierCurves.length-1]).getEndPoint().add(t),this.updateArcLengths()},e.prototype.scale=function(t,i){for(var s=0;s<this.bezierCurves.length;s++){var r=this.bezierCurves[s];e._scalePoint(r.getStartPoint(),t,i),e._scalePoint(r.getStartControlPoint(),t,i),e._scalePoint(r.getEndControlPoint(),t,i)}this.bezierCurves.length>0&&e._scalePoint(this.bezierCurves[this.bezierCurves.length-1].getEndPoint(),t,i),this.updateArcLengths()},e._scalePoint=function(t,e,i){t.sub(e),t.setX(t.x*i.x),t.setY(t.y*i.y),t.add(e)},e.prototype.getPointAt=function(t){if(t<0||t>this.totalArcLength)return console.log("[IKRS.BezierPath.getPointAt(u)] u is out of bounds: "+t+"."),null;for(var e=0,i=0;e<this.bezierCurves.length&&i+this.bezierCurves[e].getLength()<t;)i+=this.bezierCurves[e].getLength(),e++;if(e>=this.bezierCurves.length)return this.bezierCurves[this.bezierCurves.length-1].getEndPoint().clone();var s=t-i;return this.bezierCurves[e].getPointAt(s)},e.prototype.getPoint=function(t){return this.getPointAt(t*this.totalArcLength)},e.prototype.getTangent=function(t){return this.getTangentAt(t*this.totalArcLength)},e.prototype.getTangentAt=function(t){if(t<0||t>this.totalArcLength)return console.warn("[BezierPath.getTangentAt(u)] u is out of bounds: "+t+"."),null;for(var e=0,i=0;e<this.bezierCurves.length&&i+this.bezierCurves[e].getLength()<t;)i+=this.bezierCurves[e].getLength(),e++;var s=t-i;return this.bezierCurves[e].getTangentAt(s)},e.prototype.getPerpendicular=function(t){return this.getPerpendicularAt(t*this.totalArcLength)},e.prototype.getPerpendicularAt=function(t){if(t<0||t>this.totalArcLength)return console.log("[IKRS.BezierPath.getPerpendicularAt(u)] u is out of bounds: "+t+"."),null;for(var e=0,i=0;e<this.bezierCurves.length&&i+this.bezierCurves[e].getLength()<t;)i+=this.bezierCurves[e].getLength(),e++;var s=t-i;return this.bezierCurves[e].getPerpendicularAt(s)},e.prototype.computeBoundingBox=function(){if(0==this.bezierCurves.length)return new BoundingBox(0,0,0,0);for(var t=this.bezierCurves[0].computeBoundingBox(),e=1;e<this.bezierCurves.length;e++){var i=this.bezierCurves[e].computeBoundingBox();t.xMin=Math.min(t.xMin,i.xMin),t.xMax=Math.max(t.xMax,i.xMax),t.yMin=Math.min(t.yMin,i.yMin),t.yMax=Math.max(t.yMax,i.yMax)}return t},e.prototype.moveCurvePoint=function(t,e,i){if(this.getCurveAt(t).moveCurvePoint(e,i,!0,!0),e==this.START_POINT&&(t>0||this.adjustCircular))this.getCurveAt(t-1<0?this.bezierCurves.length+(t-1):t-1).moveCurvePoint(this.END_CONTROL_POINT,i,!0,!1);else if(e==this.END_POINT&&(t+1<this.bezierCurves.length||this.adjustCircular)){this.getCurveAt((t+1)%this.bezierCurves.length).moveCurvePoint(this.START_CONTROL_POINT,i,!0,!1)}else e==this.START_CONTROL_POINT&&t>0?this.adjustPredecessorControlPoint(t,!0,!1):e==this.END_CONTROL_POINT&&t+1<this.getCurveCount()&&this.adjustSuccessorControlPoint(t,!0,!1);this.updateArcLengths()},e.prototype.adjustPredecessorControlPoint=function(t,e,i){if(!this.adjustCircular&&t<=0)return!1;var s=this.getCurveAt(t),r=this.getCurveAt(t-1<0?this.getCurveCount()+(t-1):t-1);return this.adjustNeighbourControlPoint(s,r,s.getStartPoint(),s.getStartControlPoint(),r.getEndPoint(),r.getEndControlPoint(),e,i)},e.prototype.adjustSuccessorControlPoint=function(t,e,i){if(!this.adjustCirculat&&t+1>this.getCurveCount())return!1;var s=this.getCurveAt(t),r=this.getCurveAt((t+1)%this.getCurveCount());return this.adjustNeighbourControlPoint(s,r,s.getEndPoint(),s.getEndControlPoint(),r.getStartPoint(),r.getStartControlPoint(),e,i)},e.prototype.adjustNeighbourControlPoint=function(t,e,i,s,r,n,o,a){var h=new Vertex(s.x-i.x,s.y-i.y),c=new Vertex(n.x-r.x,n.y-r.y),u=Math.sqrt(Math.pow(h.x,2)+Math.pow(h.y,2)),l=Math.sqrt(Math.pow(c.x,2)+Math.pow(c.y,2));u<=.1||(n.set(r.x-h.x*(l/u),r.y-h.y*(l/u)),e.updateArcLengths())},e.prototype.clone=function(){for(var t=new e(null),i=0;i<this.bezierCurves.length;i++)t.bezierCurves.push(this.bezierCurves[i].clone()),i>0&&(t.bezierCurves[i-1].endPoint=t.bezierCurves[i].startPoint);return t.updateArcLengths(),t},e.prototype.equals=function(t){if(!t)return!1;if(!t.bezierCurves)return!1;if(void 0===t.bezierCurves.length)return!1;if(t.bezierCurves.length!=this.bezierCurves.length)return!1;for(var e=0;e<this.bezierCurves.length;e++)if(!this.bezierCurves[e].equals(t.bezierCurves[e]))return!1;return!0},e.prototype.toSVGString=function(t){t=t||{};var e=[];e.push("<path"),t.className&&e.push(' class="'+t.className+'"'),e.push(' d="');for(var i=0;i<this.bezierCurves.length;i++)i>0&&e.push(" "),e.push(this.bezierCurves[i].toSVGPathData());return e.push('" />'),e.join("")},e.prototype.toJSON=function(t){var e=[];e.push("[");for(var i=0;i<this.bezierCurves.length;i++)i>0&&e.push(","),t?e.push("\n\t"):e.push(" "),e.push(this.bezierCurves[i].toJSON(t));return 0!=this.bezierCurves.length&&e.push(" "),e.push("]"),e.join("")},e.fromJSON=function(t){var e=JSON.parse(t);return IKRS.BezierPath.fromArray(e)},e.fromArray=function(t){if(!Array.isArray(t))throw"[IKRS.BezierPath.fromArray] Passed object must be an array.";if(t.length<1)throw"[IKRS.BezierPath.fromArray] Passed array must contain at least one bezier curve (has "+t.length+").";for(var i=new e(null),s=null,r=0;r<t.length;r++){var n=null;n=0 in t[r]&&1 in t[r]&&2 in t[r]&&3 in t[r]?CubicBezierCurve.fromArray(t[r]):CubicBezierCurve.fromObject(t[r]),s&&(n.startPoint=s.endPoint),i.bezierCurves.push(n),i.totalArcLength+=n.getLength(),s=n}return i},e.prototype.toReducedListRepresentation=function(t){void 0===t&&(t=1);var i=[];i.push("[");for(var s=0;s<this.bezierCurves.length;s++){var r=this.bezierCurves[s];i.push(e._roundToDigits(r.getStartPoint().x,t,!1)),i.push(","),i.push(e._roundToDigits(r.getStartPoint().y,t,!1)),i.push(","),i.push(e._roundToDigits(r.getStartControlPoint().x,t,!1)),i.push(","),i.push(IKRS.BezierPath._roundToDigits(r.getStartControlPoint().y,t,!1)),i.push(","),i.push(e._roundToDigits(r.getEndControlPoint().x,t,!1)),i.push(","),i.push(e._roundToDigits(r.getEndControlPoint().y,t,!1)),i.push(",")}if(0!=this.bezierCurves.length){r=this.bezierCurves[this.bezierCurves.length-1];i.push(e._roundToDigits(r.getEndPoint().x,t,!1)),i.push(","),i.push(e._roundToDigits(r.getEndPoint().y,t,!1))}return i.push("]"),i.join("")},e.fromReducedListRepresentation=function(t){var i=JSON.parse(t);if(!i.length)throw console.log("Cannot parse bezier path from non-array object nor from empty point list."),"Cannot parse bezier path from non-array object nor from empty point list.";if(i.length<8)throw console.log("Cannot build bezier path. The passed array must contain at least 8 elements (numbers)."),"Cannot build bezier path. The passed array must contain at least 8 elements (numbers).";var s=new e(null),r=null,n=null,o=null,a=null,h=0;do{0==h&&(r=new Vertex(i[h],i[h+1])),n=new Vertex(i[h+2],i[h+3]),o=new Vertex(i[h+4],i[h+5]),a=new Vertex(i[h+6],i[h+7]);var c=new CubicBezierCurve(r,a,n,o);s.bezierCurves.push(c),r=a,h+=6}while(h+2<i.length);return s.updateArcLengths(),s},e._roundToDigits=function(t,e,i){if(e<=0)return Math.round(t);var s=Math.pow(10,e),r=""+(t=Math.round(t*s))/s,n=r.lastIndexOf(".");if(-1==n&&(n=r.length),i)for(var o=i-(r.length-n-1);o-- >0;)r+="&nbsp;";return r},t.BezierPath=e}(window)},function(t,e,i){(function(t){var e;(e=window||t.export).Polygon=function(t,e){void 0===t&&(t=[]),this.vertices=t,this.isOpen=e},e.Polygon.prototype.containsVert=function(t){for(var e=!1,i=0,s=this.vertices.length-1;i<this.vertices.length;s=i++){var r=this.vertices[i].x,n=this.vertices[i].y,o=this.vertices[s].x,a=this.vertices[s].y;n>t.y!=a>t.y&&t.x<(o-r)*(t.y-n)/(a-n)+r&&(e=!e)}return e},e.Polygon.prototype.toQuadraticBezierData=function(){if(this.vertices.length<3)return[];var t=[],e=this.vertices[0],i=this.vertices[1],s=new Vertex(e.x+(i.x-e.x)/2,e.y+(i.y-e.y)/2);t.push(s);for(var r=this.isOpen?this.vertices.length:this.vertices.length+1,n=1;n<r;n++)e=this.vertices[n%this.vertices.length],i=this.vertices[(n+1)%this.vertices.length],s=new Vertex(e.x+(i.x-e.x)/2,e.y+(i.y-e.y)/2),t.push(e),t.push(s),e=i;return t},e.Polygon.prototype.toQuadraticBezierSVGString=function(){var t=this.toQuadraticBezierData();if(0==t.length)return"";for(var e=["M "+t[0].x+" "+t[0].y],i=1;i<t.length;i+=2)e.push("Q "+t[i].x+" "+t[i].y+", "+t[i+1].x+" "+t[i+1].y);return e.join(" ")},e.Polygon.prototype.toCubicBezierData=function(t){if(void 0===t&&(t=1),this.vertices.length<3)return[];var e=[],i=this.vertices[0],s=this.vertices[1],r=new Vertex(i.x+(s.x-i.x)/2,i.y+(s.y-i.y)/2);e.push(r);for(var n=this.isOpen?this.vertices.length-1:this.vertices.length,o=0;o<n;o++){i=this.vertices[o%this.vertices.length],s=this.vertices[(o+1)%this.vertices.length];var a=this.vertices[(o+2)%this.vertices.length],h=new Vertex(i.x+(s.x-i.x)/2,i.y+(s.y-i.y)/2),c=new Vertex(s.x+(a.x-s.x)/2,s.y+(a.y-s.y)/2),u=new Vertex(h.x+(s.x-h.x)*t,h.y+(s.y-h.y)*t),l=new Vertex(c.x+(s.x-c.x)*t,c.y+(s.y-c.y)*t);e.push(u),e.push(l),e.push(c)}return e},e.Polygon.prototype.toCubicBezierSVGString=function(t){var e=this.toCubicBezierData(t);if(0==e.length)return"";for(var i=["M "+e[0].x+" "+e[0].y],s=1;s<e.length;s+=3)i.push("C "+e[s].x+" "+e[s].y+", "+e[s+1].x+" "+e[s+1].y+", "+e[s+2].x+" "+e[s+2].y);return i.join(" ")},e.Polygon.prototype.toSVGString=function(t){t=t||{};var e=[];if(e.push("<path"),t.className&&e.push(' class="'+t.className+'"'),e.push(' d="'),this.vertices.length>0){e.push("M "),e.push(this.vertices[0].x),e.push(" "),e.push(this.vertices[0].y);for(var i=1;i<this.vertices.length;i++)e.push(" L "),e.push(this.vertices[i].x),e.push(" "),e.push(this.vertices[i].y);this.isOpen||e.push(" Z")}return e.push('" />'),e.join("")}}).call(this,i(0)(t))},function(t,e,i){(function(t){var e,i;e=window||t.export,(i=function(t,e){this.center=t,this.axis=e}).prototype.toSVGString=function(t){t=t||{};var e=[];return e.push("<ellipse"),t.className&&e.push(' class="'+t.className+'"'),e.push(' cx="'+this.center.x+'"'),e.push(' cy="'+this.center.y+'"'),e.push(' rx="'+this.axis.x+'"'),e.push(' ry="'+this.axis.y+'"'),e.push(" />"),e.join("")},e.VEllipse=i}).call(this,i(0)(t))},function(t,e){!function(t){window.MouseHandler=function(t){var e=null,i=null,s=-1,r={},n={},o={};function a(t){return{x:t.pageX-t.target.offsetLeft,y:t.pageY-t.target.offsetTop}}function h(r,n){var o=a(r);return r.params={element:t,name:n,pos:o,button:s,leftButton:0==s,middleButton:1==s,rightButton:2==s,mouseDownPos:e,draggedFrom:i,wasDragged:null!=e&&(e.x!=o.x||e.y!=o.y),dragAmount:null!=e?{x:o.x-i.x,y:o.y-i.y}:{x:0,y:0}},r}function c(e){console.log(e),n[e]||(t.addEventListener(e,o[e]),n[e]=!0)}function u(e){n[e]&&(t.removeEventListener(e,o[e]),delete n[e])}function l(t){throw"This MouseHandler already has a '"+t+"' callback. To keep the code simple there is only room for one."}o.mousemove=function(t){r.mousemove&&r.mousemove(h(t,"mousemove")),i&&r.drag&&r.drag(h(t,"drag")),e&&(i=a(t))},o.mouseup=function(t){r.mouseup&&r.mouseup(h(t,"mouseup")),i=null,e=null,s=-1},o.mousedown=function(t){i=a(t),e=a(t),s=t.button,r.mousedown&&r.mousedown(h(t,"mousedown"))},o.click=function(t){r.click&&r.click(h(t,"mousedown"))},o.wheel=function(t){r.wheel&&r.wheel(h(t,"wheel"))},this.drag=function(t){if(r.drag)throw"This MouseHandler already has a 'drag' callback.";return r.drag=t,c("mousedown"),c("mousemove"),c("mouseup"),r.drag=t,this},this.move=function(t){return r.mousemove&&l("mousemove"),c("mousemove"),r.mousemove=t,this},this.up=function(t){return r.mouseup&&l("mouseup"),c("mouseup"),r.mouseup=t,this},this.down=function(t){return r.mousedown&&l("mousedown"),c("mousedown"),r.mousedown=t,this},this.click=function(t){return r.click&&l("click"),c("click"),r.click=t,this},this.wheel=function(t){return r.wheel&&l("wheel"),c("wheel"),r.wheel=t,this},this.destroy=function(){console.log("destroy"),u("mousedown"),u("mousemove"),u("moseup"),u("click"),u("wheel")}}}()},function(t,e){!function(t){"use strict";var e=function(t){t=t||{},this.element=t.element?t.element:window,this.downListeners=[],this.pressListeners=[],this.upListeners=[],this.keyStates=[],this.trackAllKeys=t.trackAll||!1,this._keyDownListener=null,this._keyPressListener=null,this._keyUpListener=null,this.installListeners()},i=function(t,e){var i=!1;for(var s in e){var r=e[s];r.keyCode==t.keyCode&&(r.listener(t),i=!0)}return i},s=function(t){if("number"==typeof t)return t;if("string"!=typeof t)throw"Unknown key name or key type (should be a string or integer): "+t;if(e.KEY_CODES[t])return e.KEY_CODES[t];throw"Unknown key (cannot resolve key code): "+t};e.KEY_CODES={break:3,backspace:8,delete:8,tab:9,clear:12,enter:13,shift:16,ctrl:17,alt:18,pause:19,break:19,capslock:20,hangul:21,hanja:25,escape:27,conversion:28,"non-conversion":29,spacebar:32,pageup:33,pagedown:34,end:35,home:36,leftarrow:37,uparrow:38,rightarrow:39,downarrow:40,select:41,print:42,execute:43,printscreen:44,insert:45,delete:46,help:47,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,":":58,"semicolon (firefox)":59,equals:59,"<":60,"equals (firefox)":61,"ß":63,"@ (firefox)":64,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,windows:91,leftcommand:91,chromebooksearch:91,rightwindowkey:92,windowsmenu:93,rightcommant:93,sleep:95,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,multiply:106,add:107,numpadperiod:108,subtract:109,decimalpoint:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,f13:124,f14:125,f15:126,f16:127,f17:128,f18:129,f19:130,f20:131,f21:132,f22:133,f23:134,f24:135,numlock:144,scrolllock:145,"^":160,"!":161,"#":163,$:164,"ù":165,pagebackward:166,pageforward:167,refresh:168,closingparen:169,"*":170,"~+*":171,home:172,minus:173,mute:173,unmute:173,decreasevolumelevel:174,increasevolumelevel:175,next:176,previous:177,stop:178,"play/pause":179,email:180,mute:181,unmute:181,semicolon:186,"ñ":186,equal:187,comma:188,dash:189,period:190,forwardslash:191,"ç":191,"grave accent":192,"æ":192,"ö":192,"?":193,"/":193,"°":193,numpadperiod:194,openbracket:219,backslash:220,closebracket:221,"å":221,singlequote:222,"ø":222,"ä":222,"`":223,altgr:225,"GNOME Compose Key":230,"ç":231,XF86Forward:233,XF86Back:234,"non-conversion":235,alphanumeric:240,hiragana:242,katakana:242,"half-width":243,"full-width":243,kanji:244,unlocktrackpad:251,toggletouchpad:255},e.prototype.installListeners=function(){var t=this;this.element.addEventListener("keydown",this.keyDownListener=function(e){!function(t,e){(i(t,e.downListeners)||e.trackAllKeys)&&(e.keyStates[t.keyCode]="down")}(e,t)}),this.element.addEventListener("keypress",this.keyPressListener=function(e){!function(t,e){i(t,e.pressListeners)}(e,t)}),this.element.addEventListener("keyup",this.keyUpListener=function(e){!function(t,e){(i(t,e.upListeners)||e.trackAllKeys)&&delete e.keyStates[t.keyCode]}(e,t)})},e.prototype.releaseListeners=function(){this.element.removeEventListener("keydown",this.keyDownListener),this.element.removeEventListener("keypress",this.keyPressListener),this.element.removeEventListener("keyup",this.keyUpListener)},e.prototype.down=function(t,e){return this.downListeners.push({key:t,keyCode:s(t),listener:e}),this},e.prototype.press=function(t,e){return this.pressListeners.push({key:t,keyCode:s(t),listener:e}),this},e.prototype.up=function(t,e){return this.upListeners.push({key:t,keyCode:s(t),listener:e}),this},e.prototype.isDown=function(t){return!!this.keyStates[s(t)]},t.KeyHandler=e}(window)},function(t,e,i){(function(t){!function(t){"use strict";t.drawutils=function(t,e){this.ctx=t,this.offset=new Vertex(0,0),this.scale=new Vertex(1,1),this.fillShapes=e},t.drawutils.prototype.line=function(t,e,i){this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y),this.ctx.lineTo(this.offset.x+e.x*this.scale.x,this.offset.y+e.y*this.scale.y),this.ctx.strokeStyle=i,this.ctx.lineWidth=1,this.ctx.stroke(),this.ctx.restore()},t.drawutils.prototype._fillOrDraw=function(t){this.fillShapes?(this.ctx.fillStyle=t,this.ctx.fill()):(this.ctx.strokeStyle=t,this.ctx.stroke())},t.drawutils.prototype.cubicBezier=function(t,e,i,s,r){t instanceof CubicBezierCurve?this.cubicBezier(t.startPoint,t.endPoint,t.startControlPoint,t.endControlPoint,e):(this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y),this.ctx.bezierCurveTo(this.offset.x+i.x*this.scale.x,this.offset.y+i.y*this.scale.y,this.offset.x+s.x*this.scale.x,this.offset.y+s.y*this.scale.y,this.offset.x+e.x*this.scale.x,this.offset.y+e.y*this.scale.y),this.ctx.lineWidth=2,this._fillOrDraw(r),this.ctx.restore())},t.drawutils.prototype.handle=function(t,e){this.point(t,"rgb(0,32,192)"),this.square(e,5,"rgba(0,128,192,0.5)")},t.drawutils.prototype.cubicBezierCurveHandleLines=function(t){this.cubicBezierHandleLines(t.startPoint,t.endPoint,t.startControlPoint,t.endControlPoint)},t.drawutils.prototype.handleLine=function(t,e){this.line(t,e,"rgb(192,192,192)")},t.drawutils.prototype.point=function(t,e){this.ctx.beginPath(),this.ctx.arc(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y,3,0,2*Math.PI,!1),this.ctx.closePath(),this._fillOrDraw(e)},t.drawutils.prototype.circle=function(t,e,i){this.ctx.beginPath(),this.ctx.ellipse(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y,e*this.scale.x,e*this.scale.y,0,0,2*Math.PI),this.ctx.closePath(),this._fillOrDraw(i)},t.drawutils.prototype.ellipse=function(t,e,i,s){this.ctx.beginPath(),this.ctx.ellipse(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y,e*this.scale.x,i*this.scale.y,0,0,2*Math.PI),this.ctx.closePath(),this._fillOrDraw(s)},t.drawutils.prototype.square=function(t,e,i){this.ctx.beginPath(),this.ctx.rect(this.offset.x+(t.x-e/2)*this.scale.x,this.offset.y+(t.y-e/2)*this.scale.y,e*this.scale.x,e*this.scale.y),this.ctx.closePath(),this._fillOrDraw(i)},t.drawutils.prototype.grid=function(t,e,i,s,r,n){console.log("draw grid"),this.ctx.beginPath();for(var o=0;o<e/2;)this.ctx.moveTo(this.offset.x+(t.x+o)*this.scale.x,this.offset.y-(t.y-.5*i)*this.scale.y),this.ctx.lineTo(this.offset.x+(t.x+o)*this.scale.x,this.offset.y-(t.y+.5*i)*this.scale.y),o+=s;for(o=s;o<e/2;)this.ctx.moveTo(this.offset.x+(t.x-o)*this.scale.x,this.offset.y-(t.y-.5*i)*this.scale.y),this.ctx.lineTo(this.offset.x+(t.x-o)*this.scale.x,this.offset.y-(t.y+.5*i)*this.scale.y),o+=s;for(var a=0;a<i/2;)this.ctx.moveTo(this.offset.x-(t.x-.5*e)*this.scale.x,this.offset.y+(t.y+a)*this.scale.y),this.ctx.lineTo(this.offset.x-(t.x+.5*e)*this.scale.x,this.offset.y+(t.y+a)*this.scale.y),a+=r;for(a=r;a<i/2;)this.ctx.moveTo(this.offset.x-(t.x-.5*e)*this.scale.x,this.offset.y+(t.y-a)*this.scale.y),this.ctx.lineTo(this.offset.x-(t.x+.5*e)*this.scale.x,this.offset.y+(t.y-a)*this.scale.y),a+=r;this.ctx.closePath(),this._fillOrDraw(n)},t.drawutils.prototype.raster=function(t,e,i,s,r,n){this.ctx.save(),this.ctx.beginPath();for(var o=0,a=-Math.ceil(.5*e/s)*s;a<e/2;a+=s){o++;for(var h=-Math.ceil(.5*i/r)*r;h<i/2;h+=r)1==o&&0,this.ctx.moveTo(this.offset.x+(t.x+a)*this.scale.x-4,this.offset.y+(t.y+h)*this.scale.y),this.ctx.lineTo(this.offset.x+(t.x+a)*this.scale.x+4,this.offset.y+(t.y+h)*this.scale.y),this.ctx.moveTo(this.offset.x+(t.x+a)*this.scale.x,this.offset.y+(t.y+h)*this.scale.y-4),this.ctx.lineTo(this.offset.x+(t.x+a)*this.scale.x,this.offset.y+(t.y+h)*this.scale.y+4)}this.ctx.strokeStyle=n,this.ctx.lineWidth=1,this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore()},t.drawutils.prototype.diamondHandle=function(t,e,i){this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+t.x*this.scale.x-e/2,this.offset.y+t.y*this.scale.y),this.ctx.lineTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y-e/2),this.ctx.lineTo(this.offset.x+t.x*this.scale.x+e/2,this.offset.y+t.y*this.scale.y),this.ctx.lineTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y+e/2),this.ctx.closePath(),this._fillOrDraw(i)},t.drawutils.prototype.squareHandle=function(t,e,i){this.ctx.beginPath(),this.ctx.rect(this.offset.x+t.x*this.scale.x-e/2,this.offset.y+t.y*this.scale.y-e/2,e,e),this.ctx.closePath(),this._fillOrDraw(i)},t.drawutils.prototype.circleHandle=function(t,e,i){this.ctx.beginPath(),this.ctx.arc(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y,3,0,2*Math.PI,!1),this.ctx.closePath(),this._fillOrDraw(i)},t.drawutils.prototype.crosshair=function(t,e,i){this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+t.x*this.scale.x-e,this.offset.y+t.y*this.scale.y),this.ctx.lineTo(this.offset.x+t.x*this.scale.x+e,this.offset.y+t.y*this.scale.y),this.ctx.moveTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y-e),this.ctx.lineTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y+e),this.ctx.strokeStyle=i,this.ctx.lineWidth=.5,this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore()},t.drawutils.prototype.polygon=function(t,e){if(!(t.vertices.length<=1)){this.ctx.save(),this.ctx.beginPath(),this.ctx.setLineDash([3,5]),this.ctx.lineWidth=1,this.ctx.moveTo(this.offset.x+t.vertices[0].x*this.scale.x,this.offset.y+t.vertices[0].y*this.scale.y);for(var i=0;i<t.vertices.length;i++)this.ctx.lineTo(this.offset.x+t.vertices[i].x*this.scale.x,this.offset.y+t.vertices[i].y*this.scale.y);!t.isOpen&&t.vertices.length>2&&this.ctx.closePath(),this._fillOrDraw(e),this.ctx.setLineDash([]),this.ctx.restore()}},t.drawutils.prototype.arcto=function(t,e,i,s,r,n,o,a,h,c){t=this.offset.x+this.scale.x*t,e=this.offset.y+this.scale.y*e,a=this.offset.x+this.scale.x*a,h=this.offset.y+this.scale.y*h,i*=this.scale.x,s*=this.scale.y;var u=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))},l=function(t,e){return(t[0]*e[0]+t[1]*e[1])/(u(t)*u(e))},d=function(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(l(t,e))},f=Math.cos(r)*(t-a)/2+Math.sin(r)*(e-h)/2,p=-Math.sin(r)*(t-a)/2+Math.cos(r)*(e-h)/2,g=Math.pow(f,2)/Math.pow(i,2)+Math.pow(p,2)/Math.pow(s,2);g>1&&(i*=Math.sqrt(g),s*=Math.sqrt(g));var y=(n==o?-1:1)*Math.sqrt((Math.pow(i,2)*Math.pow(s,2)-Math.pow(i,2)*Math.pow(p,2)-Math.pow(s,2)*Math.pow(f,2))/(Math.pow(i,2)*Math.pow(p,2)+Math.pow(s,2)*Math.pow(f,2)));isNaN(y)&&(y=0);var v=y*i*p/s,x=y*-s*f/i,b=(t+a)/2+Math.cos(r)*v-Math.sin(r)*x,m=(e+h)/2+Math.sin(r)*v+Math.cos(r)*x,w=d([1,0],[(f-v)/i,(p-x)/s]),C=[(f-v)/i,(p-x)/s],P=[(-f-v)/i,(-p-x)/s],z=d(C,P);l(C,P)<=-1&&(z=Math.PI),l(C,P)>=1&&(z=0);var S=i>s?i:s,T=i>s?1:i/s,L=i>s?s/i:1;this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.translate(b,m),this.ctx.rotate(r),this.ctx.scale(T,L),this.ctx.arc(0,0,S,w,w+z,1-o),this.ctx.scale(1/T,1/L),this.ctx.rotate(-r),this.ctx.translate(-b,-m),this._fillOrDraw(c),this.ctx.restore()},t.drawutils.prototype.text=function(t,e,i,s){s=s||{},this.fillShapes?(this.ctx.fillStyle="black",this.ctx.fillText(t,e,i)):(this.ctx.strokeStyle="black",this.ctx.strokeText(t,e,i))},t.drawutils.prototype.label=function(t,e,i){this.fillShapes?(this.ctx.fillStyle="black",this.ctx.fillText(t,e,i)):(this.ctx.strokeStyle="black",this.ctx.strokeText(t,e,i))}}(window||t.export)}).call(this,i(0)(t))},function(t,e){!function(t){"use strict";var e=function(t){this.wrapper=document.getElementById(t),this.blanket=this.wrapper.getElementsByClassName("overlay-blanket")[0],this.content=this.blanket.getElementsByClassName("overlay-content")[0],s(this.wrapper,{display:"none",position:"fixed",left:"0px",top:"0px",width:"100vw",height:"100vh"}),s(this.blanket,{width:"100%",height:"100%",display:"flex","align-items":"center","justify-content":"center",background:"rgba(0,0,0,0.5)"}),s(this.content,{width:"500px",height:"500px","max-width":"50%","max-height":"50%",background:"white",border:"1px solid grey","border-radius":"5px",position:"relative"}),this._headLine=document.createElement("h3"),this._contentNode=document.createElement("div"),this._buttonLine=document.createElement("div"),this.content.innerHTML="",this.content.appendChild(this._headLine),this.content.appendChild(this._contentNode),this.content.appendChild(this._buttonLine),this._textArea=null,s(this._headLine,{width:"calc(100% - 10px)",overflow:"hidden","border-bottom":"1px solid grey",margin:"6px 0px",padding:"0px 5px 3px"}),s(this._contentNode,{width:"calc(100% - 10px)",overflow:"hidden",margin:"0px",padding:"0px 5px",position:"absolute",top:"30px",height:"calc(100% - 60px)"}),s(this._buttonLine,{width:"calc(100% - 10px)",overflow:"hidden",position:"absolute",top:"auto",bottom:"0px","text-align":"right"}),n(this._headLine,"od-hl"),n(this._contentNode,"od-cn"),n(this._buttonLine,"od-bl")};function i(t,e){if("string"==typeof e&&"close"==e)i(t,{label:"Close",onclick:function(){r(t)}});else if("string"==typeof e&&"ok"==e)console.log("add ok button"),i(t,{label:"OK",onclick:function(){r(t)}});else{var s=document.createElement("button");s.type="button",s.innerHTML=e.label?e.label:"no-label","function"==typeof e.action?s.addEventListener("click",e.action):"close"==e.action&&s.addEventListener("click",function(){r(t)}),t._buttonLine.appendChild(s)}}function s(t,e){for(var i in e)t.style[i]=e[i]}function r(t){t.wrapper.style.display="none"}function n(t,e){var i=t.className.split(" ");-1==i.indexOf(e)&&(i.push(e),t.className=i.join(" "))}e.prototype.show=function(t,e,s,r){if(this._headLine.innerHTML=e||"Please confirm",this.setMessage(t,r),this._buttonLine.innerHTML="",s)for(var n in s)i(this,s[n]);else i(this,"ok");this.wrapper.style.display="inherit"},e.prototype.setMessage=function(t,e){e={}||e,"string"==typeof t?(this._contentNode.innerHTML=t,e.messageClass&&n(this._contentNode,e.messageClass)):(this._contentNode.innerHTML="",this._contentNode.appendChild(t))},e.prototype.showTextArea=function(t,e,i,s){this._textArea=document.createElement("textarea"),this._textArea.innerHTML=t||"",this._textArea.style.width="100%",this._textArea.style.height="95%",this._textArea.style.border="0px",s&&s.messageClass&&(this._textArea.className=s.messageClass),this.show(this._textArea,e,i,s)},e.prototype.hide=function(){r(this)},t.overlayDialog=e}(window)},function(t,e){!function(t){"use strict";!function(t){var e=function(t,e){this.item=t,this.type=e,this.vindex=null,this.pindex=null,this.cindex=null};e.VERTEX="vertex",e.prototype.isVertex=function(){return this.type==e.VERTEX},e.prototype.setVIndex=function(t){return this.vindex=t,this},t.Draggable=e}(t),VertexAttr.model={bezierAutoAdjust:!1,renderTime:0,selectable:!0};var e=function(i){i=i||{},this.config={fullSize:i.fullSize||!0,fitToParent:i.fitToParent||!0,scaleX:i.scaleX||1,scaleY:i.scaleY||1,rasterGrid:i.rasterGrid||!0,rasterAdjustFactor:i.rasterAdjustFactor||2,backgroundColor:i.backgroundColor||"#ffffff",rebuild:function(){o()},loadImage:function(){var t=document.getElementById("file");t.setAttribute("data-type","image-upload"),t.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0}))},saveFile:function(){n()}},this.canvas=document.getElementById("my-canvas"),this.ctx=this.canvas.getContext("2d"),this.draw=new drawutils(this.ctx,!1),this.draw.scale.set(this.config.scaleX,this.config.scaleY),this.fill=new drawutils(this.ctx,!0),this.fill.scale.set(this.config.scaleX,this.config.scaleY),this.grid=new Grid(new Vertex(0,0),new Vertex(50,50)),this.image=null,this.imageBuffer=null,this.canvasSize={width:1024,height:768},this.vertices=[],this.selectPolygon=null,this.draggedElements=[],this.drawables=[];var s=this,r={a:new Vertex(-200,0),b:new Vertex(200,0),radius:new Vertex(100,100),rotation:0,largeArcFlag:!1,sweepFlag:!1};this.vertices.push(r.a),this.vertices.push(r.b),this.vertices.push(r.radius),e.prototype.add=function(t){if(t instanceof Line)this.drawables.push(t),this.vertices.push(t.a),this.vertices.push(t.b);else if(t instanceof VEllipse)this.vertices.push(t.center),this.vertices.push(t.axis),this.drawables.push(t),t.center.listeners.addDragListener(function(e){t.axis.add(e.params.dragAmount)});else if(t instanceof Polygon)for(var e in this.drawables.push(t),t.vertices)this.vertices.push(t.vertices[e]);else{if(!(t instanceof BezierPath))throw"Cannot add drawable of unrecognized type: "+t.constructor.name;for(var e in this.drawables.push(t),t.bezierCurves)t.adjustCircular||0!=e||this.vertices.push(t.bezierCurves[e].startPoint),this.vertices.push(t.bezierCurves[e].endPoint),this.vertices.push(t.bezierCurves[e].startControlPoint),this.vertices.push(t.bezierCurves[e].endControlPoint),t.bezierCurves[e].startControlPoint.attr.selectable=!1,t.bezierCurves[e].endControlPoint.attr.selectable=!1;for(var e in t.bezierCurves)t.bezierCurves[e].startPoint.listeners.addDragListener(function(e){var i=t.locateCurveByStartPoint(e.params.vertex);t.bezierCurves[i].startPoint.addXY(-e.params.dragAmount.x,-e.params.dragAmount.y),t.moveCurvePoint(1*i,t.START_POINT,e.params.dragAmount)}),t.bezierCurves[e].startControlPoint.listeners.addDragListener(function(e){var i=t.locateCurveByStartControlPoint(e.params.vertex);t.bezierCurves[i].startPoint.attr.bezierAutoAdjust&&t.adjustPredecessorControlPoint(1*i,!0,!0)}),t.bezierCurves[e].endControlPoint.listeners.addDragListener(function(e){var i=t.locateCurveByEndControlPoint(e.params.vertex);t.bezierCurves[i%t.bezierCurves.length].endPoint.attr.bezierAutoAdjust&&t.adjustSuccessorControlPoint(1*i,!0,!0)})}this.redraw()},e.prototype.redraw=function(){var t=(new Date).getTime();this.ctx.fillStyle=this.config.backgroundColor,this.ctx.fillRect(0,0,this.canvasSize.width,this.canvasSize.height);var e={x:Grid.utils.mapRasterScale(this.config.rasterAdjustFactor,this.draw.scale.x),y:Grid.utils.mapRasterScale(this.config.rasterAdjustFactor,this.draw.scale.y)};console.log(this.config.rasterAdjustFactor,this.draw.scale.x,e.x,e.y),this.config.rasterGrid?this.draw.raster(this.grid.center,(this.canvasSize.width+this.draw.offset.x)/this.draw.scale.x,(this.canvasSize.height+this.draw.offset.y)/this.draw.scale.y,this.grid.size.x*e.x,this.grid.size.y*e.y,"rgba(0,128,255,0.125)"):this.draw.grid(this.grid.center,(this.canvasSize.width+this.draw.offset.x)/this.draw.scale.x,(this.canvasSize.height+this.draw.offset.y)/this.draw.scale.y,this.grid.size.x*e.x,this.grid.size.y*e.y,"rgba(0,128,255,0.095)"),s.image&&(s.config.fitImage?s.ctx.drawImage(s.image,0,0,s.image.width,s.image.height,0,0,s.canvasSize.width,s.canvasSize.height):s.ctx.drawImage(s.image,0,0));var i=r;try{this.draw.arcto(i.a.x,i.a.y,i.radius.x,Math.abs(i.radius.y),i.rotation,!i.largeArcFlag,!i.sweepFlag,i.b.x,i.b.y,"#c8c8c8"),this.draw.arcto(i.a.x,i.a.y,i.radius.x,Math.abs(i.radius.y),i.rotation,i.largeArcFlag,i.sweepFlag,i.b.x,i.b.y,"#008888")}catch(t){console.error(t)}var n=Math.min(s.canvasSize.width,s.canvasSize.height)/3;for(var o in s.draw.circle({x:0,y:0},n,"#000000"),this.drawables){if((i=this.drawables[o])instanceof BezierPath)for(var a in i.bezierCurves)this.draw.cubicBezier(i.bezierCurves[a].startPoint,i.bezierCurves[a].endPoint,i.bezierCurves[a].startControlPoint,i.bezierCurves[a].endControlPoint,"#00a822"),i.bezierCurves[a].startPoint.attr.bezierAutoAdjust||(this.draw.diamondHandle(i.bezierCurves[a].startPoint,7,"orange"),i.bezierCurves[a].startPoint.attr.renderTime=t),i.bezierCurves[a].endPoint.attr.bezierAutoAdjust||(this.draw.diamondHandle(i.bezierCurves[a].endPoint,7,"orange"),i.bezierCurves[a].endPoint.attr.renderTime=t),this.draw.circleHandle(i.bezierCurves[a].startControlPoint,7,"#008888"),this.draw.circleHandle(i.bezierCurves[a].endControlPoint,7,"#008888"),i.bezierCurves[a].startControlPoint.attr.renderTime=t,i.bezierCurves[a].endControlPoint.attr.renderTime=t,this.draw.handleLine(i.bezierCurves[a].startPoint,i.bezierCurves[a].startControlPoint),this.draw.handleLine(i.bezierCurves[a].endPoint,i.bezierCurves[a].endControlPoint);else i instanceof Polygon?this.draw.polygon(i,"#0022a8"):i instanceof VEllipse?(this.draw.line(i.center.clone().add(0,i.axis.y-i.center.y),i.axis,"#c8c8c8"),this.draw.line(i.center.clone().add(i.axis.x-i.center.x,0),i.axis,"#c8c8c8"),this.draw.ellipse(i.center,Math.abs(i.axis.x-i.center.x),Math.abs(i.axis.y-i.center.y),"#2222a8")):i instanceof Line?this.draw.line(i.a,i.b,"#a844a8"):console.error("Cannot draw object. Unknown class "+i.constructor.name+".")}for(var o in this.vertices)this.vertices[o].attr.renderTime!=t&&this.draw.squareHandle(this.vertices[o],5,this.vertices[o].attr.isSelected?"rgba(192,128,0)":"rgb(0,128,192)");null!=this.selectPolygon&&this.selectPolygon.vertices.length>0&&(console.log("Drawing selectPolygon",this.selectPolygon.vertices.length,"vertices"),this.draw.polygon(this.selectPolygon,"#888888"),this.draw.crosshair(this.selectPolygon.vertices[0],3,"#008888"))};e.prototype.clearSelection=function(t){for(var e in this.vertices)this.vertices[e].attr.isSelected=!1;return t&&this.redraw(),this};document.getElementById("file").addEventListener("change",function(t){var e=document.getElementById("file").getAttribute("data-type");"image-upload"==e?function(t){if(-1!="image/gif,image/jpeg,image/jpg,image/gif,image/png".indexOf(t.target.files[0].type)||window.confirm("This seems not to be an image ("+t.target.files[0].type+"). Continue?")){var e=new FileReader;e.onload=function(t){this.image=new Image,this.image.onload=function(){var t=document.createElement("canvas");t.width=this.image.width,t.height=this.image.height,t.getContext("2d").drawImage(this.image,0,0,this.image.width,image.height),alert("Sorry, not yet implemented.")},this.image.src=t.target.result},e.readAsDataURL(t.target.files[0])}}(t):console.warn("Unrecognized upload type: "+e)});var n=function(){var t=(new SVGBuilder).build(s.drawables,{canvasSize:s.canvasSize,offset:s.draw.offset,zoom:s.draw.scale}),e=new Blob([t],{type:"image/svg;charset=utf-8"});saveAs(e,"plot-boilerplate.svg")},o=function(){};e.prototype.resizeCanvas=function(){var t=function(t,e){s.ctx.canvas.width=t,s.ctx.canvas.height=e,s.canvas.width=t,s.canvas.height=e,s.canvasSize.width=t,s.canvasSize.height=e,s.draw.offset.x=s.fill.offset.x=t/2,s.draw.offset.y=s.fill.offset.y=e/2};if(s.config.fullSize&&!s.config.fitToParent)t(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight);else if(s.config.fitToParent){t(s.canvas.parentNode.clientWidth-2,s.canvas.parentNode.clientHeight-2)}else t(1024,768);s.redraw()},t.addEventListener("resize",this.resizeCanvas),this.resizeCanvas(),e.prototype.selectVerticesInPolygon=function(t){for(var e in this.vertices)t.containsVert(this.vertices[e])&&(this.vertices[e].attr.isSelected=!0)};var a=function(t){for(var e in s.vertices){var i=s.vertices[e];if(i.distance(t)<7)return new Draggable(i,Draggable.VERTEX).setVIndex(e)}return!1};e.prototype.transformMousePosition=function(t,e){return{x:(t-this.draw.offset.x)/this.draw.scale.x,y:(e-this.draw.offset.y)/this.draw.scale.y}};new MouseHandler(this.canvas).down(function(t){if(1==t.which){var e=a(s.transformMousePosition(t.params.pos.x,t.params.pos.y));if(e){if("vertex"==e.type&&s.vertices[e.vindex].attr.isSelected)for(var i in s.vertices)s.vertices[i].attr.isSelected&&(s.draggedElements.push(new Draggable(s.vertices[i],Draggable.VERTEX).setVIndex(i)),s.vertices[i].listeners.fireDragStartEvent(t));else s.draggedElements.push(e),"bpath"==e.type?s.paths[e.pindex].bezierCurves[e.cindex].getPointByID(e.pid).listeners.fireDragStartEvent(t):"vertex"==e.type&&s.vertices[e.vindex].listeners.fireDragStartEvent(t);s.redraw()}}}).drag(function(t){if(h.isDown("alt"))s.draw.offset.add(t.params.dragAmount),s.fill.offset.set(s.draw.offset),s.redraw();else for(var e in t.params.dragAmount.x/=s.draw.scale.x,t.params.dragAmount.y/=s.draw.scale.y,s.draggedElements){var i=s.draggedElements[e];"bpath"==i.type?(s.paths[i.pindex].moveCurvePoint(i.cindex,i.pid,t.params.dragAmount),s.paths[i.pindex].bezierCurves[i.cindex].getPointByID(i.pid).listeners.fireDragEvent(t)):"vertex"==i.type&&(s.vertices[i.vindex].add(t.params.dragAmount),s.vertices[i.vindex].listeners.fireDragEvent(t))}s.redraw()}).up(function(t){if(1==t.which){for(var e in t.params.wasDragged||function(t,e){var i=a(s.transformMousePosition(t,e));if(i)if(h.isDown("shift")){if("bpath"==i.type){let t=s.paths[i.pindex].bezierCurves[i.cindex].getPointByID(i.pid);t.attr.selectable&&(t.attr.isSelected=!t.attr.isSelected)}else if("vertex"==i.type){let t=s.vertices[i.vindex];t.attr.selectable&&(t.attr.isSelected=!t.attr.isSelected)}s.redraw()}else h.isDown("y")&&(s.vertices[i.vindex].attr.bezierAutoAdjust=!s.vertices[i.vindex].attr.bezierAutoAdjust,console.log("bezierAutoAdjust="+s.vertices[i.vindex].attr.bezierAutoAdjust),s.redraw());else if(null!=s.selectPolygon){var r=s.transformMousePosition(t,e);s.selectPolygon.vertices.push(r),s.redraw()}}(t.params.pos.x,t.params.pos.y),s.draggedElements){var i=s.draggedElements[e];"bpath"==i.type?s.paths[i.pindex].bezierCurves[i.cindex].getPointByID(i.pid).listeners.fireDragEndEvent(t):"vertex"==i.type&&s.vertices[i.vindex].listeners.fireDragEndEvent(t)}s.draggedElements=[],s.redraw()}}).wheel(function(t){t.deltaY<0?(s.draw.scale.x=s.fill.scale.x=s.config.scaleX=1.25*s.config.scaleX,s.draw.scale.y=s.fill.scale.y=s.config.scaleY=1.25*s.config.scaleY):t.deltaY>0&&(s.draw.scale.x=s.fill.scale.x=s.config.scaleX=s.config.scaleX/1.25,s.draw.scale.y=s.fill.scale.y=s.config.scaleY=s.config.scaleY/1.25),s.redraw()});var h=new KeyHandler({trackAll:!0}).down("enter",function(){console.log("ENTER was hit.")}).press("enter",function(){console.log("ENTER was pressed.")}).up("enter",function(){console.log("ENTER was released.")}).down("alt",function(){console.log("alt was hit.")}).press("alt",function(){console.log("alt was pressed.")}).up("alt",function(){console.log("alt was released.")}).down("escape",function(){console.log("ESCAPE was hit."),s.clearSelection(!0)}).down("shift",function(){console.log("SHIFT was hit."),s.selectPolygon=new Polygon,s.redraw()}).up("shift",function(){console.log("SHIFT was released."),null!=s.selectPolygon&&(s.selectVerticesInPolygon(s.selectPolygon),s.selectPolygon=null,s.redraw())}).down("y",function(){console.log("y was hit.")}).up("y",function(){console.log("y was released.")}).down("e",function(){console.log("e was hit. shift is pressed?",h.isDown("shift"))}).up("windows",function(){console.log("windows was released.")});window.dialog=new overlayDialog("dialog-wrapper"),this.redraw(),this.canvas.focus()};t.PlotBoilerplate=e}(window)}]);